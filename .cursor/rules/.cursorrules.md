# BTC Pump/Dump Trading Bot - Project Rules

## Project Overview
This is a cryptocurrency trading signal bot that analyzes Bitcoin (BTC/USDT) and predicts PUMP/DUMP movements using technical indicators and machine learning. The bot sends signals via Telegram.

## Tech Stack
- **Language**: Python 3.9+
- **Framework**: python-telegram-bot 20.7
- **Exchange API**: ccxt (Binance)
- **ML**: scikit-learn, Random Forest
- **Data**: pandas, numpy
- **Database**: SQLite3
- **Indicators**: ta library, custom implementations

## Project Structure
```
btc_pump_dump_bot/
├── config.py              # Configuration and environment variables
├── database.py            # SQLite database operations
├── data_collector.py      # Binance API data collection
├── indicators.py          # Technical indicators (RSI, MACD, BB, etc)
├── ml_model.py           # ML model and rule-based prediction
├── telegram_bot.py       # Telegram bot handlers
├── main.py              # Main application entry point
├── utils.py             # Helper utilities
├── .env                 # Environment variables (NEVER commit)
├── bot.log             # Log file (auto-generated)
└── btc_signals.db      # SQLite database (auto-generated)
```

## Core Concepts

### Trading Strategy
- **Target**: Bitcoin (BTC/USDT)
- **Timeframe**: 5-minute candles
- **Analysis Period**: 100 candles (8 hours history)
- **Check Interval**: 300 seconds (5 minutes)
- **Signal Types**: PUMP (bullish), DUMP (bearish), NEUTRAL
- **Trading Style**: Swing trading (4-24 hours)

### Technical Indicators Used
1. **RSI (14)**: Overbought/oversold detection
2. **MACD (12,26,9)**: Trend change detection
3. **Bollinger Bands (20,2)**: Volatility and extremes
4. **EMA (50, 200)**: Trend direction
5. **Volume Analysis**: Movement confirmation
6. **Momentum (10)**: Price velocity
7. **ATR (14)**: Volatility measurement
8. **Fear & Greed Index**: Market sentiment

### Signal Logic
- Signals are generated using a **scoring system**
- Each indicator contributes positive (PUMP) or negative (DUMP) points
- Score >= 4: PUMP signal
- Score <= -4: DUMP signal
- Score -3 to +3: NEUTRAL
- Minimum probability threshold: 70%

## Coding Standards

### General Rules
1. **Always use type hints** for function parameters and return values
2. **Add docstrings** to all classes and functions
3. **Log important events** using the logging module
4. **Handle exceptions** gracefully with try-except blocks
5. **Never hardcode values** - use config.py
6. **Follow PEP 8** style guide

### Naming Conventions
- **Classes**: PascalCase (e.g., `DataCollector`, `MLPredictor`)
- **Functions**: snake_case (e.g., `get_market_data`, `calculate_rsi`)
- **Constants**: UPPER_SNAKE_CASE (e.g., `TELEGRAM_BOT_TOKEN`, `RSI_PERIOD`)
- **Private methods**: prefix with underscore (e.g., `_internal_method`)

### Error Handling
```python
# Always handle API errors
try:
    data = exchange.fetch_ticker(symbol)
except ccxt.NetworkError as e:
    logger.error(f"Network error: {e}")
    return None
except ccxt.ExchangeError as e:
    logger.error(f"Exchange error: {e}")
    return None
except Exception as e:
    logger.error(f"Unexpected error: {e}", exc_info=True)
    return None
```

### Logging Best Practices
```python
# Use appropriate log levels
logger.debug("Detailed debug information")
logger.info("General informational messages")
logger.warning("Warning messages")
logger.error("Error messages")
logger.critical("Critical errors")

# Include context in logs
logger.info(f"Market data collected: Price=${price:.2f}, Change={change}%")
```

## Database Schema

### price_data table
- Stores historical price and indicator data
- Used for analysis and backtesting
- Columns: id, timestamp, price, volume, rsi, macd, macd_signal, bb_upper, bb_lower, fear_greed_index

### signals table
- Stores generated signals and their results
- Used for accuracy calculation
- Columns: id, timestamp, signal_type, probability, price, confidence, actual_result, result_price, result_timestamp

### users table
- Stores Telegram bot users
- Columns: user_id, username, first_name, subscribed, joined_at

## API Integration

### Binance API
- **No authentication required** for public data
- Use `ccxt.binance()` without API keys
- Enable rate limiting: `enableRateLimit: True`
- Handle network errors gracefully

### Telegram Bot API
- Token stored in `.env` file
- Use async/await for all handlers
- Always respond to user commands
- Handle button callbacks

### Fear & Greed API
- Endpoint: `https://api.alternative.me/fng/`
- Free, no authentication
- Returns value 0-100
- Handle API failures (return default value 50)

## Configuration Management

### Environment Variables (.env)
```bash
TELEGRAM_BOT_TOKEN=your_token_here
BINANCE_API_KEY=  # Optional, not used
BINANCE_API_SECRET=  # Optional, not used
```

### Config Parameters (config.py)
- All thresholds, periods, and settings in one place
- Easy to adjust for different trading styles
- Well-documented with comments

## Security Best Practices

### Critical Rules
1. **NEVER commit .env file** to git
2. **NEVER log sensitive data** (API keys, tokens)
3. **NEVER store passwords** in plain text
4. **Always validate user input** in bot commands
5. **Use .gitignore** to exclude sensitive files

### .gitignore Must Include
```
.env
*.db
*.log
*.pkl
__pycache__/
```

## ML Model Guidelines

### Current Implementation
- **Rule-based system** as default (no training required)
- Scoring algorithm based on technical indicators
- Deterministic and explainable results

### Future ML Model
- Train on historical data (3-6 months minimum)
- Use Random Forest or XGBoost
- Save/load models with joblib
- Fallback to rule-based if model fails
- Regular retraining (weekly/monthly)

## Testing Strategy

### Manual Testing
1. Test with paper trading first
2. Verify all Telegram commands work
3. Check signal generation logic
4. Monitor logs for errors

### Edge Cases to Handle
- Network disconnections
- API rate limits
- Invalid data from APIs
- Database connection errors
- Bot token expiration

## Performance Optimization

### Data Collection
- Minimize API calls
- Cache Fear & Greed Index (update every 5 min)
- Batch database operations

### Memory Management
- Limit DataFrame size (100 candles max)
- Clear old data from memory
- Use generators for large datasets

## Deployment Considerations

### Local Deployment
- Keep terminal open while bot runs
- Monitor logs in real-time
- Restart on crashes (use systemd/supervisor)

### VPS Deployment (Future)
- Use screen or tmux for persistent sessions
- Set up automatic restart on failure
- Configure firewall rules
- Use systemd service

### Heroku Deployment (Future)
- Add Procfile: `worker: python main.py`
- Use Heroku Postgres addon
- Configure environment variables
- Worker dyno (not web)

## Common Issues and Solutions

### Issue: "ModuleNotFoundError"
**Solution**: Install dependencies with `pip install -r requirements.txt`

### Issue: Bot not responding in Telegram
**Solution**: Check token in .env, verify bot is polling, check internet connection

### Issue: "ccxt.NetworkError"
**Solution**: Check internet, try VPN if Binance blocked, increase timeout

### Issue: No signals generated
**Solution**: This is normal - signals only sent when probability >= 70%

### Issue: Database locked
**Solution**: Close other connections, use `conn.close()` after operations

## Code Review Checklist

Before committing code, verify:
- [ ] No hardcoded credentials
- [ ] All functions have docstrings
- [ ] Error handling in place
- [ ] Logging statements added
- [ ] No print() statements (use logger)
- [ ] Type hints added
- [ ] Config values used (not hardcoded)
- [ ] Database connections closed
- [ ] API errors handled
- [ ] Code follows PEP 8

## Feature Development Workflow

### Adding New Indicator
1. Add calculation in `indicators.py`
2. Add to `calculate_all_indicators()` function
3. Update ML feature preparation in `ml_model.py`
4. Test with historical data
5. Update documentation

### Adding New Bot Command
1. Create handler function in `telegram_bot.py`
2. Add to `setup_handlers()`
3. Update help text
4. Test command
5. Handle errors

### Modifying Signal Logic
1. Update scoring in `ml_model.py`
2. Test on historical data
3. Monitor accuracy for 1 week
4. Adjust weights if needed
5. Document changes

## Documentation Requirements

### Function Docstrings
```python
def calculate_rsi(df: pd.DataFrame, period: int = 14) -> float:
    """
    Calculate RSI (Relative Strength Index)
    
    Args:
        df: DataFrame with OHLCV data
        period: RSI period (default: 14)
        
    Returns:
        float: RSI value (0-100)
        
    Raises:
        ValueError: If DataFrame is empty or missing 'close' column
    """
```

### Code Comments
- Explain WHY, not WHAT
- Use comments for complex logic
- Keep comments up to date
- Remove commented-out code

## Cursor AI Assistant Guidelines

When helping with this project:
1. **Understand the trading context** - this is a real-money trading bot
2. **Prioritize safety** - never suggest risky changes to signal logic
3. **Maintain consistency** - follow existing code patterns
4. **Explain financial concepts** - help user understand indicators
5. **Consider edge cases** - API failures, network issues, bad data
6. **Test suggestions** - provide examples that can be tested
7. **Respect configuration** - use config.py values, don't hardcode
8. **Log appropriately** - suggest proper logging for debugging

## Future Enhancements Roadmap

### Phase 1 (Current)
- [x] Rule-based signal generation
- [x] Telegram bot integration
- [x] SQLite database
- [x] Basic technical indicators

### Phase 2 (Next)
- [ ] ML model training
- [ ] Backtesting framework
- [ ] Performance analytics dashboard
- [ ] Multiple timeframe analysis

### Phase 3 (Future)
- [ ] Support for altcoins
- [ ] Web dashboard
- [ ] Paper trading mode
- [ ] Advanced risk management

## Resources and References

### Documentation
- ccxt: https://docs.ccxt.com/
- python-telegram-bot: https://docs.python-telegram-bot.org/
- pandas: https://pandas.pydata.org/docs/
- scikit-learn: https://scikit-learn.org/stable/

### Trading Concepts
- Technical Analysis: https://www.investopedia.com/technical-analysis-4689657
- RSI: https://www.investopedia.com/terms/r/rsi.asp
- MACD: https://www.investopedia.com/terms/m/macd.asp

## Contact and Support

- Project maintained by: [Your Name]
- Issues: Track in project notes
- Questions: Ask Cursor AI for clarification

---

**Remember**: This bot deals with real money and trading decisions. Always prioritize safety, testing, and risk management over speed of development.
